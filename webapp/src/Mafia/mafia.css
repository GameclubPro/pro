/* mafia.css — BLACK STEEL / BRUTAL UI (updated)
 * ---------------------------------------------------------------------------
 * Список улучшений для «топового» дизайна:
 * 1) Визуальная система и читабельность:
 *    • Шкала текста/контраста: заголовки 18–20px; вторичка 12–13px; тело 14–16px; баннеры 28–40px.
 *    • Таймер (critical/danger/warn) доведён до WCAG AA на тёмном фоне.
 *    • Токены цветов ролей (--role-mafia, --role-civil, ...), единый стиль бейджей/неона.
 *    • Единые уровни поднятия: surface/raised/floating/modal.
 * 2) Сетка и адаптив:
 *    • Пороги 390/480/720/1024: тонкая подстройка --mf-grid-gap, --mf-center-max, --mf-ava.
 *    • В ландшафте на мобилках — --mf-ava -12%, чтобы влезало +15–20% игроков.
 *    • В лобби добавлена «сводка готовности» — стилизована здесь.
 * 3) Состояния/микро-взаимодействия:
 *    • Видимые pressed/selected (не только в VOTE).
 *    • Skeleton-лоадеры аватарок (серые карты с shimmer).
 *    • Tooltip через aria-describedby (ненавязчивые мини-плашки).
 * 4) Движение/FX:
 *    • Единые тайминги/кривые: --ease-out, --ease-in; длительности 180/240/360/560ms.
 *    • Фазовый «цветовой всплеск» 120–180мс (mf-phase-flash).
 *    • Подправлен «just-started»: подсказка шага исчезает мягче.
 * 5) Доступность:
 *    • role="alertdialog" стили для NightAlertToast (центральный, только «ОК»).
 *    • Поддержка prefers-contrast: more (усиленные бордеры/фоны).
 *    • Skip-link в начало (.mf-skip).
 * 6) Производительность:
 *    • Предзагрузка ролевых аватарок (в JSX).
 *    • IntersectionObserver для ленивой отрисовки PlayerCard (в JSX).
 *    • На low-end отключены большие тени, will-change: auto.
 * 7) Темизация/брендинг:
 *    • Тема horror-light / noir-blue через data-theme на <html>.
 *    • Лого/hero — мягкий glow на узких экранах.
 * 8) Копирайтинг:
 *    • Тексты тостов/подсказок унифицированы (см. utils/parseToastMessage.js).
 *    • Баннер финала поддерживает субтайтл (разделитель \n).
 * 9) Код-гигиена:
 *    • parseToastMessage вынесен в модуль.
 *    • useModalA11y — кастом ESC (shake) для «обязательного ОК».
 * ---------------------------------------------------------------------------
 */

/* ============================== TOKENS / BASE ============================== */
:root{
  --mf-bg:#0a0c0f;
  --mf-bg2:#0e1116;
  --mf-fg:#e8ecf2;
  --mf-muted:#b3b9c2;

  --mf-accent:#8ea4b5;
  --mf-accent2:#a9baca;

  --mf-danger:#d14d4d;
  --mf-ok:#65c39a;
  --mf-warn:#d7b568;
  --mf-owner:#cfeff7;

  --mf-border:#2b313a;
  --mf-sep:#1b2028;

  --mf-round:14px;
  --mf-round-sm:10px;
  --mf-font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue",
             Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";

  --mf-glass: rgba(16,18,22,.50);
  --mf-glass-strong: rgba(16,18,22,.66);
  --mf-soft-shadow: 0 2px 14px rgba(0,0,0,.45);

  --mf-vh: var(--tg-vh, 100svh); --mf-vw: 1dvw;
  --mf-pad-y: var(--app-pad-y, 12px);
  --mf-safe-top-extra: 12px;
  /* Safe area + общий app padding (как на главной) */
  --mf-safe-top: calc(max(env(safe-area-inset-top, 0px), var(--safe-top, 20px), 20px) + var(--mf-pad-y) + var(--mf-safe-top-extra));
  --mf-safe-bottom: calc(max(var(--safe-bottom, 0px), env(safe-area-inset-bottom, 0px), 12px) + var(--mf-pad-y));

  --mf-center-min: 64px;
  --mf-center-max: 520px;
  --mf-grid-gap: 12px;
  --mf-edge-pad: 8px;

  --mf-ava: 64px;

  --mf-menu-accent: var(--mf-accent);
  --mf-menu-accent2: var(--mf-accent2);
  --mf-menu-bg-dark:#121418;
  --mf-menu-bg-darker:#0b0e12;
  --mf-menu-glass: rgba(16,18,22,.50);

  --mf-grate-gap: 28px;

  --mf-scene-bg:
    radial-gradient(100% 120% at 0 0, color-mix(in lab, var(--mf-accent) 10%, transparent) 0, transparent 60%),
    radial-gradient(120% 140% at 100% 0, color-mix(in lab, var(--mf-accent2) 8%, transparent) 0, transparent 58%),
    linear-gradient(180deg, var(--mf-bg) 0%, var(--mf-bg2) 100%);

  --mf-phase-fade-ms: 700ms;
  --mf-phase-tint: color-mix(in lab, var(--mf-accent) 16%, transparent);

  /* === NEW: единые тайминги/кривые === */
  --ease-out: cubic-bezier(.2,.8,.2,1);
  --ease-in: cubic-bezier(.4,0,.2,1);
  --dur-180: 180ms;
  --dur-240: 240ms;
  --dur-360: 360ms;
  --dur-560: 560ms;

  /* === NEW: уровни поднятия === */
  --elev-surface: 0 1px 0 rgba(255,255,255,.04) inset, 0 6px 18px rgba(0,0,0,.35);
  --elev-raised:  0 1px 0 rgba(255,255,255,.05) inset, 0 10px 24px rgba(0,0,0,.45);
  --elev-floating:0 1px 0 rgba(255,255,255,.06) inset, 0 14px 32px rgba(0,0,0,.50);
  --elev-modal:   0 1px 0 rgba(255,255,255,.06) inset, 0 18px 40px rgba(0,0,0,.60);

  /* === NEW: цвета ролей (токены) === */
  --role-mafia:      #e36d6d;
  --role-don:        var(--role-mafia);
  --role-doctor:     #6fe2a0;
  --role-sheriff:    #ffe08a;
  --role-civil:      #c0c6cf;
  --role-bodyguard:  #a6d2ff;
  --role-prostitute: #ffb2e3;
  --role-journalist: #c6cdff;
  --role-sniper:     #ffc2a1;
}

/* Фазы */
body.mf-phase-night{
  --mf-accent:#8ea4b5; --mf-accent2:#b8c6d2;
  --mf-phase-tint: color-mix(in lab, #aab4bf 22%, transparent);
  --mf-scene-bg:
    radial-gradient(120% 140% at 0% 0%, color-mix(in lab, #9aa5b1 14%, transparent), transparent 60%),
    radial-gradient(140% 160% at 100% 0%, color-mix(in lab, #7b8794 10%, transparent), transparent 58%),
    linear-gradient(180deg, #0a0c0f 0%, #10141b 100%);
}
body.mf-phase-day{
  --mf-accent:#9fb2c1; --mf-accent2:#c5d0db;
  --mf-phase-tint: color-mix(in lab, #d0d6de 16%, transparent);
  --mf-scene-bg:
    radial-gradient(120% 140% at 0% 0%, color-mix(in lab, #c2c9d2 14%, transparent), transparent 60%),
    radial-gradient(140% 160% at 100% 0%, color-mix(in lab, #a9b1bb 10%, transparent), transparent 58%),
    linear-gradient(180deg, #0b0e12 0%, #14181f 100%);
}
body.mf-phase-vote{
  --mf-accent:#a7b9c7; --mf-accent2:#cad6e0;
  --mf-phase-tint: color-mix(in lab, var(--mf-accent) 18%, transparent);
  --mf-scene-bg:
    radial-gradient(120% 140% at 0% 0%, color-mix(in lab, var(--mf-accent) 12%, transparent), transparent 60%),
    radial-gradient(140% 160% at 100% 0%, color-mix(in lab, var(--mf-accent2) 8%, transparent), transparent 58%),
    linear-gradient(180deg, #0a0c0f 0%, #0e1116 100%);
}
body.mf-phase-lobby{ --mf-phase-tint: color-mix(in lab, var(--mf-accent) 14%, transparent); }

/* База */
*{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html,body,#root{ height:100%; }
html{ overflow-x:hidden; scrollbar-gutter: stable both-edges; }
html, body{ overscroll-behavior-y: none; }
body{
  margin:0; min-height:100%;
  background: var(--mf-scenes-bg, var(--mf-scene-bg));
  color:var(--mf-fg);
  font-family:var(--mf-font);
  font-kerning: normal; text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
  font-size: 14.5px; line-height: 1.5; /* тело 14–16px */
}

/* Телеграм-темы */
:root.theme-tg {
  --mf-bg: var(--tg-theme-bg-color, #0a0c0f);
  --mf-fg: var(--tg-theme-text-color, #e8ecf2);
  --mf-accent: var(--tg-theme-accent-text-color, #8ea4b5);
  --mf-border: color-mix(in lab, var(--mf-fg) 8%, transparent);
}

/* Доступность: движение */
@media (prefers-reduced-motion: reduce){
  *, *::before, *::after{
    animation-duration:0.001ms !important;
    animation-iteration-count:1 !important;
    transition-duration:0.001ms !important;
    scroll-behavior:auto !important;
  }
}

/* Low-end tweaks */
body.mf-lowend {
  --mf-soft-shadow: none;
}
body.mf-lowend *{ transition-duration:.001ms !important; animation-duration:.001ms !important; will-change: auto !important; }
body.mf-lowend .mf-gamestage,
body.mf-lowend .mf-hud,
body.mf-lowend .mf-feed .mf-feed-item,
body.mf-lowend .mf-events-card,
body.mf-lowend .mf-hero,
body.mf-lowend .mf-net,
body.mf-lowend .mf-alerttoast-card{ -webkit-backdrop-filter:none !important; backdrop-filter:none !important; box-shadow: none !important; }
body.mf-lowend .mf-tex{ display:none !important; }

/* Экономия трафика/эффектов при reduce-data */
@media (prefers-reduced-data: reduce){
  .mf-tex, .mf-tex-phasebg, .mf-tex-dayfx, .mf-tex-nightfx, .mf-tex-votefx, .mf-tex-noise{
    display:none !important;
  }
  .mf-ava-bronze::after{
    /* гасим «неон» от голосов, оставляя контур */
    opacity:.35;
    box-shadow:none;
  }
}

/* ============================== APP SHELL / SCENE FX ============================== */
.mf-app{ width:100%; margin:0; min-height: var(--mf-vh); padding:0; display:block; }
.mf-room-shell{ position:relative; margin:0; isolation:isolate; min-height: var(--mf-vh); }

.mf-room{
  position:relative;
  display:flex; flex-direction:column; gap:14px;
  min-height: var(--mf-vh);
  padding-top: var(--mf-safe-top);
  padding-left: var(--app-inset-left);
  padding-right: var(--app-inset-right);
  padding-bottom: var(--mf-safe-bottom);
}

.mf-tex{ position:absolute; inset:0; pointer-events:none; z-index:-1; }

/* Фото-фоны с кросс-фейдом */
.mf-tex-phasebg{
  z-index:-3;
  opacity:0;
  transition: opacity var(--mf-phase-fade-ms) ease, filter var(--mf-phase-fade-ms) ease;
  background-image: var(--phase-bg-image);
  background-position:center center;
  background-repeat:no-repeat;
  background-size:cover;
  filter: saturate(.9) contrast(1.04) brightness(.96);
  will-change: opacity;
}
.mf-tex-phasebg.is-active{ opacity:1; }

/* Боке/ночные FX */
.mf-tex-phasebg::after{ content:""; position:absolute; inset:0; background:none; mix-blend-mode: normal; }
.mf-tex-dayfx{
  opacity:0; transition:opacity .35s ease;
  background:
    radial-gradient( circle at 10% 22%, rgba(255,255,255,.05) 0 2px, transparent 3px ),
    radial-gradient( circle at 82% 26%, rgba(255,255,255,.04) 0 2px, transparent 3px ),
    conic-gradient(from -24deg at 8% -14%, color-mix(in lab, #dfe5ee 10%, transparent), transparent 36%),
    conic-gradient(from -30deg at 0% -6%, color-mix(in lab, #b9c3cf 10%, transparent), transparent 42%);
  mix-blend-mode: screen; filter: blur(.25px);
}
body.mf-phase-day .mf-tex-dayfx{ opacity:.38; }
.mf-tex-nightfx{
  opacity:0; transition:opacity .35s ease;
  background:
    radial-gradient(100% 120% at 90% -10%, color-mix(in lab, #a7b2bf 16%, transparent), transparent 60%),
    radial-gradient( circle at 20% 25%, rgba(255,255,255,.20) 0 1px, transparent 2px ),
    radial-gradient( circle at 40% 15%, rgba(255,255,255,.14) 0 1px, transparent 2px ),
    radial-gradient( circle at 65% 30%, rgba(255,255,255,.18) 0 1px, transparent 2px );
  mix-blend-mode: screen;
}
body.mf-phase-night .mf-tex-nightfx{ opacity:.45; }

/* «Голос» FX */
.mf-tex-votefx{
  opacity:0; transition:opacity .35s ease;
  background:
    conic-gradient(from 90deg at 50% 112%,
      color-mix(in lab, var(--mf-accent) 20%, transparent),
      transparent 30%,
      color-mix(in lab, #c8d2de 12%, transparent) 45%,
      transparent 65%,
      color-mix(in lab, var(--mf-accent) 20%, transparent) 85%,
      transparent 100%),
    radial-gradient(120% 60% at 50% 110%, rgba(0,0,0,.45), transparent 60%);
  mix-blend-mode: overlay;
}
body.mf-phase-vote .mf-tex-votefx{ opacity:.45; }

.mf-tex-vignette{ display:none; }
.mf-tex-noise{
  background:
    repeating-linear-gradient(0deg, rgba(255,255,255,.02) 0 1px, transparent 1px 2px),
    repeating-linear-gradient(90deg, rgba(255,255,255,.02) 0 1px, transparent 1px 2px);
  opacity:.18;
}
.mf-tex-spot{
  --mx:.5; --my:.18;
  background:
    radial-gradient(60% 140% at calc(var(--mx) * 100%) calc(var(--my) * 100%),
      color-mix(in lab, var(--mf-accent) 14%, transparent), transparent 60%);
  filter: blur(.2px);
}

/* ============================== HUD / BUTTONS ============================== */
.mf-hud{
  background:var(--mf-glass);
  border:1px solid var(--mf-border);
  border-radius:var(--mf-round); padding:12px;
  backdrop-filter: blur(6px) saturate(120%);
  box-shadow: var(--elev-surface);
  position:relative;
}
.mf-hud-row{ display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; margin-top:10px; }
.mf-hud-row:first-child{ margin-top:0; }
.mf-hud.just-started .mf-hud-row{ opacity:0; transform: translateY(-8px); animation: mf-slide-down .58s var(--ease-out) forwards; }
@keyframes mf-slide-down { to { opacity:1; transform: translateY(0); } }

.mf-code{
  display:flex; align-items:center; gap:8px;
  background:linear-gradient(180deg, rgba(22,24,28,.42), rgba(16,18,22,.36));
  border:1px solid var(--mf-border); border-radius:999px; padding:6px 10px;
  min-width:220px; box-shadow: 0 2px 8px rgba(0,0,0,.35) inset;
  flex: 1 1 auto; min-width: 0;
}
.mf-code-label{ color:var(--mf-muted); font-size:12px; letter-spacing:.06em; text-transform:uppercase; }
.mf-code-value{
  font-weight:900; letter-spacing:.12em; font-size:16px; padding:2px 8px;
  background: linear-gradient(180deg, color-mix(in lab, var(--mf-accent) 18%, transparent), color-mix(in lab, var(--mf-accent) 6%, transparent));
  border-radius:8px;
  user-select:all; white-space:nowrap;
}

.mf-hud-actions{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; padding:4px; border-radius:10px; background: linear-gradient(180deg, rgba(24,26,30,.35), rgba(18,20,24,.25)); border:1px solid rgba(64,70,80,.65); box-shadow: 0 2px 10px rgba(0,0,0,.28) inset; }

.mf-chip{
  background:#161a1f; color:var(--mf-fg); border:1px solid var(--mf-border); border-radius:999px; padding:6px 10px; font-size:12px; line-height: 1; min-height: 30px; display:inline-flex; align-items:center; transition: background .15s ease, transform .1s ease, box-shadow .2s ease, border-color .2s ease; box-shadow: 0 2px 8px rgba(0,0,0,.25); cursor:pointer;
}
.mf-chip:hover{ background:#1b2026; transform: translateY(-1px); }
.mf-chip:active{ transform: translateY(0); }
.mf-chip.ghost{ background:transparent; color:#e1e4ea; border-style:dashed; border-color:#3a404c; }
.mf-chip.ghost:hover{ background:rgba(27,32,38,.35); border-color:#4a5160; }
.mf-chip.danger{ background:#2b1515; border-color:#532525; color:#ffd6d6; box-shadow:none; }
.mf-chip.owner{ background:#152022; border-color:#274044; color:#c6fff1; }
.mf-chip.primary{
  background: linear-gradient(180deg, #2b333d, #1a1f26);
  color:#e8edf4; border:1px solid #49515b; font-weight:900;
  box-shadow: 0 1px 0 rgba(255,255,255,.05) inset, 0 6px 18px rgba(0,0,0,.35);
}

.mf-btn{
  background: linear-gradient(180deg,#1a1f26,#11161c);
  color:var(--mf-fg);
  border:1px solid #2f353e;
  border-radius:12px;
  padding:10px 12px;
  cursor:pointer;
  transition:.15s transform ease, .15s background ease, box-shadow .2s ease, border-color .2s ease;
  box-shadow:
    0 1px 0 rgba(255,255,255,.04) inset,
    0 8px 16px rgba(0,0,0,.35);
  min-height:44px;
  font-weight:800;
  letter-spacing:.02em;
}
.mf-btn:hover{ background: linear-gradient(180deg,#212833,#151b22); border-color:#3a424c; }
.mf-btn:active{ transform: translateY(1px); }
.mf-btn.primary{
  background:
    linear-gradient(180deg,#2d3641 0%, #1b2129 100%) padding-box,
    linear-gradient(120deg,#6b7784,#a3b1be) border-box;
  border:1px solid transparent;
  color:#eaf0f6;
  text-shadow: 0 1px 0 rgba(0,0,0,.65);
  box-shadow:
    0 1px 0 rgba(255,255,255,.06) inset,
    0 10px 24px rgba(0,0,0,.45);
}
.mf-btn.primary[disabled]{ opacity:.6; pointer-events:none; filter: grayscale(.3) brightness(.92); }
.mf-btn.big{ width:100%; padding:12px 14px; font-size:16px; border-radius:14px; }
.mf-btn.sm{ min-height:34px; padding:6px 10px; border-radius:10px; font-size:13px; }
.mf-btn.ghost{ background:transparent; border:1px dashed #3a404c; color:var(--mf-muted); }
.mf-btn.danger{ background:#2b1515; border:1px solid #5a2a2a; }
.mf-btn.disabled{ opacity:.6; pointer-events:none; }
.mf-hud-hint{ margin-top:8px; font-size:13px; color:#dfe3ea; opacity:.95; }

/* ============================== TIMER ============================== */
.mf-timer{
  position:relative; display:flex; align-items:center; gap:8px;
  background:#191c21; border:1px solid var(--mf-border); border-radius:999px; padding:6px 10px; width:100%; min-width:0;
}
.mf-timer-icon{ opacity:.9 }
.mf-timer-text{ font-weight:900; letter-spacing:.05em; font-variant-numeric: tabular-nums; font-feature-settings: "tnum"; width: 5ch; text-align:right; transition: color .2s ease; }
.mf-timer-bar{ position:relative; flex:1; height:6px; background:#14171c; border-radius:999px; overflow:hidden; }
.mf-timer-bar i{
  display:block; height:100%; width:100%;
  background: linear-gradient(90deg, var(--mf-accent), var(--mf-accent2));
  transform-origin: left center;
  animation: mf-depleteX var(--msLeft, 0ms) linear forwards;
  will-change: transform;
}
@keyframes mf-depleteX { from{ transform: scaleX(1) } to{ transform: scaleX(0) } }
.mf-timer.critical .mf-timer-text{ color: var(--mf-danger); }
.mf-timer.critical .mf-timer-bar i{
  background: linear-gradient(90deg, #ff4d4d, #ff8a8a);
}
.mf-timer.critical{
  box-shadow: none;
  color: #ffd8d8;
}

/* ============================== GAME STAGE ============================== */
.mf-gamestage{
  position:relative;
  padding:12px 14px 14px;
  border-radius:18px;
  margin-top:8px;
  border:1px solid color-mix(in lab, var(--mf-fg) 8%, transparent);
  background:
    linear-gradient(180deg, rgba(22,24,28,.78), rgba(12,14,18,.62)) padding-box,
    radial-gradient(160% 200% at 0% 0%, color-mix(in lab, var(--mf-accent) 20%, transparent), transparent 60%) border-box;
  box-shadow: var(--elev-raised);
  backdrop-filter: blur(12px) saturate(130%);
  isolation:isolate;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.mf-gamestage.animate{
  box-shadow:
    0 0 0 1px color-mix(in lab, var(--mf-accent) 12%, transparent),
    var(--elev-floating);
}
.mf-gs-appear{ opacity:0; transform: translateY(-6px) scale(.98); animation: mf-stage-in .42s var(--ease-out) forwards; }
@keyframes mf-stage-in{ to{ opacity:1; transform: translateY(0) scale(1); } }

.mf-gs-tiles{
  display:flex;
  flex-wrap:nowrap;
  gap:10px;
  align-items:stretch;
}
.mf-gs-pill{
  position:relative;
  display:flex; align-items:center; gap:10px;
  padding:8px 11px;
  border-radius:16px;
  background:
    linear-gradient(180deg, rgba(24,26,32,.55), rgba(18,20,26,.55)) padding-box,
    radial-gradient(120% 160% at 100% 0%, rgba(255,255,255,.05), transparent 60%) padding-box;
  border:1px solid color-mix(in lab, var(--mf-fg) 10%, transparent);
  box-shadow: 0 1px 0 rgba(255,255,255,.05) inset, 0 12px 28px rgba(0,0,0,.42);
  color:#e7ebf3;
  font-weight:900;
  letter-spacing:.04em;
  text-shadow: 0 1px 0 rgba(0,0,0,.35);
  flex:1 1 0;
  min-width:0;
}
.mf-gs-pill::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius:14px;
  border:1px dashed rgba(255,255,255,.06);
  opacity:.6;
  pointer-events:none;
}
.mf-gs-pill .ico{ font-size:22px; filter: drop-shadow(0 4px 8px rgba(0,0,0,.35)); }
.mf-gs-pill .txt{ font-size:18px; line-height:1.2; white-space:nowrap; }
.mf-gs-pill.idle{ opacity:.78; }
.mf-gs-pill.active{
  background:
    linear-gradient(180deg, color-mix(in lab, var(--mf-accent) 16%, rgba(24,26,32,.8)), rgba(18,20,24,.86)) padding-box,
    radial-gradient(120% 160% at 0% 0%, color-mix(in lab, var(--mf-accent2) 20%, transparent), transparent 70%) border-box;
  border-color: color-mix(in lab, var(--mf-accent) 46%, var(--mf-fg) 6%);
  box-shadow:
    0 0 0 1px color-mix(in lab, var(--mf-accent) 26%, transparent),
    0 12px 28px rgba(0,0,0,.55),
    0 1px 0 rgba(255,255,255,.08) inset;
  opacity:1;
}
.mf-gs-pill.active::after{
  border-color: color-mix(in lab, var(--mf-accent) 38%, transparent);
  opacity:.9;
}

.mf-gs-bottom{
  display:flex;
  gap:10px;
  align-items:stretch;
  flex-wrap:nowrap;
}
.mf-gs-timer-card,
.mf-gs-daycard{
  position:relative;
  padding:8px 11px;
  border-radius:16px;
  background:
    linear-gradient(180deg, rgba(22,24,28,.8), rgba(14,16,20,.7)) padding-box,
    radial-gradient(120% 160% at 0% 0%, color-mix(in lab, var(--mf-accent) 14%, transparent), transparent 70%) border-box;
  border:1px solid color-mix(in lab, var(--mf-fg) 8%, transparent);
  box-shadow: 0 1px 0 rgba(255,255,255,.05) inset, 0 12px 28px rgba(0,0,0,.42);
  backdrop-filter: blur(8px);
}
.mf-gs-timer-card{ flex:1.1 1 0; display:flex; align-items:center; min-width:0; }
.mf-gs-daycard{
  flex:0 0 clamp(120px, 26vw, 158px);
  margin-left:auto;
  display:grid;
  grid-template-columns:auto 1fr;
  align-items:center;
  column-gap:10px;
}
.mf-gs-daycard .label{
  color:#d3d7df;
  font-size:12px;
  letter-spacing:.08em;
  text-transform:uppercase;
}
.mf-gs-daycard .val{
  justify-self:end;
  font-weight:1000;
  font-size:28px;
  letter-spacing:.08em;
  line-height:1.1;
  color:#f6f8fb;
  text-shadow: 0 1px 0 rgba(0,0,0,.35);
}

.mf-timer{
  position:relative;
  display:flex;
  align-items:center;
  gap:10px;
  background:
    linear-gradient(180deg, rgba(20,22,28,.92), rgba(12,14,18,.82)) padding-box,
    radial-gradient(120% 160% at 0% 0%, rgba(255,255,255,.06), transparent 70%) border-box;
  border:1px solid color-mix(in lab, var(--mf-fg) 10%, transparent);
  border-radius:14px;
  padding:9px 11px;
  width:100%;
  min-width:0;
  box-shadow: 0 1px 0 rgba(255,255,255,.06) inset, 0 10px 24px rgba(0,0,0,.42);
}
.mf-timer.skeleton{ opacity:.65; }
.mf-timer-icon{
  opacity:.9;
  font-size:18px;
}
.mf-timer-text{
  font-weight:1000;
  letter-spacing:.08em;
  font-variant-numeric: tabular-nums;
  font-feature-settings: "tnum";
  width: 5ch;
  text-align:right;
  transition: color .2s ease;
  color:#f4f6fb;
}
.mf-timer-bar{
  position:relative;
  flex:1;
  height:8px;
  background: linear-gradient(180deg, rgba(18,20,26,.9), rgba(10,12,16,.9));
  border-radius:999px;
  overflow:hidden;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.05);
}
.mf-timer-bar i{
  display:block;
  height:100%;
  width:100%;
  background: linear-gradient(90deg, #f8f8fa, color-mix(in lab, var(--mf-accent) 60%, #dce4ef));
  transform-origin: left center;
  animation: mf-depleteX var(--msLeft, 0ms) linear forwards;
  will-change: transform;
}
.mf-timer.critical .mf-timer-bar i{
  background: linear-gradient(90deg, #ffb0b0, #ff5858);
}

@media (max-width: 720px){
  .mf-gs-tiles{ flex-wrap:nowrap; }
  .mf-gs-bottom{ flex-wrap:nowrap; }
  .mf-gs-daycard{ grid-template-columns: auto auto; }
}
@media (max-width: 420px){
  .mf-gamestage{ padding:10px 12px 12px; gap:10px; }
  .mf-gs-pill{ padding:8px 9px; }
  .mf-gs-pill .txt{ font-size:16px; }
}

/* ============================== FINAL BANNER ============================== */
.mf-final-banner{
  position:relative; padding:12px; border-radius:16px; isolation:isolate;
  border:1px solid transparent;
  background:
    linear-gradient(180deg, rgba(22,24,28,.6), rgba(14,16,20,.45)) padding-box,
    radial-gradient(120% 180% at 0% 0%, color-mix(in lab, var(--mf-accent) 18%, transparent), transparent 60%) border-box;
  box-shadow: var(--elev-raised);
  text-align:center;
}
.mf-final-banner .txt{
  font-weight:1000;
  letter-spacing:.12em;
  font-size: clamp(28px, 7vw, 40px);
  text-shadow: 0 1px 0 rgba(0,0,0,.45);
  animation: mf-final-pop .5s var(--ease-out) both;
}
.mf-final-banner .sub{
  margin-top:6px; opacity:.95; font-size: 14px; color: #dfe3ea;
}
.mf-final-banner.win-mafia .txt{
  color: var(--mf-danger);
  text-shadow: 0 0 24px rgba(209,77,77,.35), 0 1px 0 rgba(0,0,0,.45);
}
.mf-final-banner.win-city .txt{
  color: var(--mf-ok);
  text-shadow: 0 0 24px rgba(101,195,154,.35), 0 1px 0 rgba(0,0,0,.45);
}
@keyframes mf-final-pop{
  0%{ opacity:0; transform: translateY(-8px) scale(.98); }
  100%{ opacity:1; transform: translateY(0) scale(1); }
}

/* ============================== MENU v2 ============================== */
.mf-menu{
  display:flex; flex-direction:column; gap:12px;
  --menu-gap: 14px;
  --menu-pad-x: clamp(14px, 4vw, 24px);
  --menu-pad-y: clamp(12px, 3.2vh, 18px);
  padding: calc(var(--menu-pad-y) + var(--mf-safe-top)) var(--menu-pad-x) var(--menu-pad-y);
  margin-top: clamp(6px, 1.6vh, 14px);
}
.mf-menu > *{ width:100%; max-width: min(720px, 100%); margin-inline:auto; }

.mf-menu.v2{
  --pad-x: clamp(14px, 4vw, 28px);
  --pad-y: clamp(12px, 3.2vh, 20px);
  display:flex; flex-direction:column; gap:16px;
  padding: calc(var(--pad-y) + var(--mf-safe-top)) var(--pad-x) var(--pad-y);
  margin-top: clamp(6px, 1.6vh, 14px);
}
.mf-menu.v2 > *{ width:100%; max-width:min(860px, 100%); margin-inline:auto; }

.mf-menu-hero{
  position:relative; overflow:hidden; isolation:isolate;
  padding: clamp(32px, 9vh, 72px) var(--pad-x) clamp(18px, 5vh, 28px);
  border-radius: 20px;
  border: 1px solid color-mix(in lab, var(--mf-accent) 30%, transparent);
  background:
    radial-gradient(140% 180% at 10% -10%, color-mix(in lab, var(--mf-accent) 14%, transparent), transparent 60%),
    radial-gradient(160% 200% at 110% -20%, color-mix(in lab, var(--mf-accent2) 12%, transparent), transparent 58%),
    linear-gradient(180deg, color-mix(in lab, #121417 65%, var(--mf-bg) 35%), color-mix(in lab, #0d0f12 65%, var(--mf-bg2) 35%));
  box-shadow: 0 10px 32px rgba(0,0,0,.48), 0 0 0 1px rgba(255,255,255,.04) inset;
  backdrop-filter: blur(8px) saturate(120%);
}
.mf-menu-hero::after{
  content:""; position:absolute; inset:0; pointer-events:none; border-radius:inherit;
  background: radial-gradient(80% 160% at calc(var(--mx, .5)*100%) calc(var(--my, .18)*100%), color-mix(in lab, var(--mf-accent) 10%, transparent), transparent 60%);
  mix-blend-mode: screen; opacity:.45;
}
.mf-menu-logo{
  font-size: clamp(36px, 9vw, 64px);
  line-height:1; letter-spacing:.18em; font-weight:1000; text-align:center;
  background: linear-gradient(180deg, #ffffff 0%, #dfe7ee 82%);
  -webkit-background-clip: text; background-clip: text; color: transparent;
  text-shadow: 0 0 6px rgba(0,0,0,.25), 0 3px 0 rgba(0,0,0,.35);
}
.mf-menu-tagline{
  margin: 10px auto 0; text-align:center; max-width: 38ch;
  color: color-mix(in lab, var(--mf-muted) 70%, #fff 30%);
  text-shadow: 0 1px 0 rgba(0,0,0,.35);
}

.mf-menu-actions{ display:flex; flex-direction:column; gap:12px; padding: 0 var(--pad-x); }
.mf-join-inline{
  display:grid; grid-template-columns: 1fr auto; gap:10px;
  background: linear-gradient(180deg, rgba(20,22,26,.92), rgba(14,16,20,.90));
  border:1px solid color-mix(in lab, var(--mf-accent) 22%, #3a404c 78%);
  border-radius: 16px; padding: 10px;
  box-shadow: var(--mf-soft-shadow);
}
.mf-input.big{
  min-height: 48px; font-size: 16px; border-radius: 12px;
  border:1px solid var(--mf-border); background:#11141a; color: var(--mf-fg);
  padding: 12px 12px; width:100%;
}
.mf-form-hint{ font-size: 13px; padding: 0 4px; }
.mf-form-hint.danger{ color: var(--mf-danger); }

.mf-btn.xl{
  width:100%; padding: 16px 18px; font-size: 18px; border-radius: 16px;
}
.mf-create-cta{
  position: sticky; bottom: calc(8px + var(--mf-safe-bottom));
  background:
    linear-gradient(180deg,#2d3641 0%, #1b2129 100%) padding-box,
    linear-gradient(120deg,#6b7784,#a3b1be) border-box;
  border:1px solid transparent;
  color:#eaf0f6;
  text-shadow: 0 1px 0 rgba(0,0,0,.65);
  box-shadow:
    0 1px 0 rgba(255,255,255,.06) inset,
    0 10px 24px rgba(0,0,0,.45);
  letter-spacing:.03em; font-weight:1000;
  transform: translateZ(0);
}
.mf-create-cta:hover{ filter: saturate(1.02); }
.mf-create-cta:active{ transform: translateY(1px); }

.mf-recent{ display:flex; gap:8px; flex-wrap:wrap; margin-top: 2px; }

.mf-menu-cards{
  display:grid; gap:10px; padding: 0 var(--pad-x);
  grid-template-columns: repeat(3, minmax(0, 1fr));
}
@media (max-width: 720px){
  .mf-menu-cards{ grid-template-columns: 1fr; }
}
.mf-menu-card{
  display:grid; grid-template-columns: auto 1fr; column-gap:10px; row-gap:4px; align-items:start;
  padding: 12px; border-radius: 14px;
  background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
  border:1px solid rgba(255,255,255,.08); box-shadow: 0 6px 22px rgba(0,0,0,.28) inset;
  backdrop-filter: blur(6px);
}
.mf-menu-card .ico{ font-size: 20px; filter: drop-shadow(0 2px 6px rgba(0,0,0,.35)); }
.mf-menu-card .title{ font-weight:900; letter-spacing:.02em; }
.mf-menu-card .text{ color:#d8dbe2; margin:0; grid-column: 1 / -1; }

.mf-menu-footer{ display:flex; align-items:center; gap:8px; padding: 4px var(--pad-x) 0; }
.mf-menu-footer .muted{ color: var(--mf-muted); font-size: 12px; }
.mf-menu-footer .spacer{ flex:1; }

/* ============================== GRID ============================== */
.mf-grid{
  display:flex;
  flex-direction:column;
  gap: var(--mf-grid-gap);
  align-items:stretch;
  width:100%;
  contain: layout;
  overflow: visible;
  flex: 1 1 auto;
  --mf-center-col: clamp(170px, 34vw, 320px);
}
.mf-row{
  display:grid;
  grid-template-columns: minmax(0,1fr) var(--mf-center-col) minmax(0,1fr);
  gap: var(--mf-grid-gap);
  align-items:flex-start;
}
.mf-row.center-only{
  grid-template-columns: 1fr;
  justify-items:center;
}
.mf-row + .mf-row{ margin-top:2px; }
.mf-slot{ display:flex; justify-content:center; min-height: 0; }
.mf-slot.left{ justify-content:flex-start; padding-left: 10px; }
.mf-slot.right{ justify-content:flex-end; padding-right: 10px; }
.mf-slot.center{ justify-content:center; }
.mf-slot.center > *{ width:100%; }
.mf-slot.empty{ visibility:hidden; min-width: var(--mf-ava); }
.mf-center-cta{
  display:flex; flex-direction:column; gap:8px;
  width:100%; max-width: var(--mf-center-max); margin-inline:auto;
  align-items:center; justify-content:center;
}
.mf-inline-pair{
  display:flex;
  gap: var(--mf-grid-gap);
  align-items:flex-start;
  justify-content:space-between;
  width:100%;
  padding-inline: calc(var(--mf-grid-gap) * 0.75);
}
.mf-stage{
  position:relative;
  isolation:isolate;
}
.mf-hint.center{ text-align:center; color: var(--mf-muted); font-size:12px; opacity:.95; }

/* ============================== CTA (Events/Start) ============================== */
.mf-events-toggle{
  --cta-bg: linear-gradient(135deg, rgba(26,30,38,.94), rgba(12,14,20,.9));
  --cta-border: linear-gradient(120deg,#7a88a2,#9db5c8);
  position:sticky;
  top: calc(12px + var(--mf-safe-top));
  display:inline-flex; align-items:center; justify-content:center; gap:10px;
  padding:12px 18px; min-height:44px;
  border-radius:14px; border:1px solid transparent;
  background: var(--cta-bg) padding-box, var(--cta-border) border-box;
  box-shadow: 0 10px 22px rgba(0,0,0,.45), 0 0 0 1px rgba(255,255,255,.04) inset;
  font-weight:1000; letter-spacing:.02em;
  transition: transform .15s ease, box-shadow .25s ease, filter .25s ease, background .2s ease, border-color .2s ease;
  max-inline-size: min(100%, var(--mf-center-max)); align-self: center;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis; z-index:10;
  color:#eaf0f6; text-shadow: 0 1px 0 rgba(0,0,0,.65);
}
.mf-events-toggle::before{
  content:""; position:absolute; inset:0; border-radius:inherit; pointer-events:none;
  background:
    linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,0) 40%) top/100% 60% no-repeat,
    radial-gradient(60% 220% at 50% -100%, rgba(255,255,255,.10), rgba(255,255,255,0) 60%) no-repeat;
  mix-blend-mode: screen; opacity:.4;
}
.mf-events-toggle:hover{ transform: translateY(-1px); box-shadow: 0 14px 28px rgba(0,0,0,.52), 0 0 0 1px rgba(255,255,255,.08) inset; }
.mf-events-toggle:active{ transform: translateY(0); filter: saturate(1.04); }
.mf-events-toggle.open{
  --cta-bg: linear-gradient(180deg,#2d3641 0%, #1b2129 100%);
  color:#eaf0f6;
  box-shadow: 0 6px 18px rgba(0,0,0,.35);
}
.mf-events-toggle.disabled, .mf-events-toggle[disabled]{ opacity:.6; pointer-events:none; }

/* Липкий CTA (Начать / Готов) */
.mf-events-toggle.mf-start-toggle,
.mf-events-toggle.mf-ready-toggle{
  position: sticky;
  top: calc(18px + var(--mf-safe-top));
  bottom: auto;
  width: auto;
  max-inline-size: min(100%, var(--mf-center-max));
  align-self: center;
  z-index: 24;
  box-shadow:
    0 1px 0 rgba(255,255,255,.08) inset,
    0 14px 28px rgba(0,0,0,.48);
}
.mf-events-toggle.mf-start-toggle{
  --cta-bg: linear-gradient(135deg,#2c3948 0%, #131922 55%, #101520 100%);
  --cta-border: linear-gradient(120deg,#6c8bd8 0%, #4cc6a8 50%, #9fb4ff 100%);
  letter-spacing:.05em;
  text-transform: uppercase;
}
.mf-events-toggle.mf-ready-toggle{
  --cta-bg: linear-gradient(135deg,#202733 0%, #0d1118 60%, #0b1016 100%);
  --cta-border: linear-gradient(120deg,#586575 0%, #7b8ca0 100%);
  letter-spacing:.03em;
}
.mf-vote-toggle{
  --cta-bg: linear-gradient(135deg,#1c222c 0%, #0d1116 60%, #0a0e14 100%);
  --cta-border: linear-gradient(120deg,#6b7784 0%, #8da1b8 100%);
  display:inline-flex; align-items:center; justify-content:center; gap:8px;
  padding:11px 14px; min-height:42px;
  border-radius:12px; border:1px solid transparent;
  background: var(--cta-bg) padding-box, var(--cta-border) border-box;
  box-shadow: 0 8px 18px rgba(0,0,0,.42), 0 0 0 1px rgba(255,255,255,.04) inset;
  font-weight:900; letter-spacing:.02em;
  color:#eaf0f6; text-shadow: 0 1px 0 rgba(0,0,0,.6);
  width:100%;
  transition: transform .12s ease, box-shadow .2s ease, filter .2s ease, background .2s ease;
}
.mf-vote-toggle:hover{ transform: translateY(-1px); box-shadow: 0 12px 24px rgba(0,0,0,.48); }
.mf-vote-toggle:active{ transform: translateY(0); filter: saturate(1.05); }
.mf-vote-toggle.open{
  --cta-bg: linear-gradient(180deg,#2d3641 0%, #1b2129 100%);
  box-shadow: 0 8px 18px rgba(0,0,0,.38);
}
.mf-events-toggle.mf-ready-toggle.ok{
  --cta-bg: linear-gradient(135deg,#1c2f22 0%, #0c1711 70%, #0b140f 100%);
  --cta-border: linear-gradient(120deg,#56c78c 0%, #7ae0a8 60%, #3fa96d 100%);
  box-shadow:
    0 1px 0 rgba(255,255,255,.1) inset,
    0 14px 26px rgba(0,0,0,.42),
    0 0 0 1px rgba(90,196,135,.3);
}
.mf-events-toggle.mf-start-toggle:hover,
.mf-events-toggle.mf-ready-toggle:hover{ filter: saturate(1.03); }
.mf-events-toggle.mf-start-toggle:active,
.mf-events-toggle.mf-ready-toggle:active{ transform: translateY(1px); }

/* Индикатор непрочитанного */
.mf-events-toggle.has-unread::after{
  content:""; position:absolute; right:10px; top:8px; width:10px; height:10px; border-radius:50%;
  background:#d7b568; box-shadow:none;
}

/* ============================== PLAYER TILE ============================== */
.mf-player{
  position:relative; width: var(--mf-ava); max-width: var(--mf-ava); background:transparent; border:none; border-radius:0; padding:6px 0 12px; display:flex; flex-direction:column; align-items:center; gap:6px; min-width:0; outline: none;
  overflow: visible !important;
}
.mf-player.me .mf-nick{ text-decoration:underline; text-underline-offset:2px; }
.mf-player.ghosted{ opacity:1; filter:grayscale(.35); }
/* убираем нативные эффекты при клике/фокусе мышью */
.mf-player:focus, .mf-player:active{ outline:none !important; box-shadow:none !important; }
/* возвращаем заметный фокус для клавиатуры на рамке аватара */
.mf-player:focus-visible .mf-ava-bronze{
  box-shadow: 0 0 0 3px color-mix(in lab, var(--mf-accent) 35%, transparent), var(--mf-soft-shadow);
}
/* Визуально показать, что кандидат закрыт для голосования во 2-м раунде */
.mf-player.vote-locked{ filter: grayscale(.35) opacity(.75); cursor: not-allowed; }

/* NEW: явная подсветка выбранного кандидата (везде, не только в VOTE) */
.mf-player[aria-pressed="true"] .mf-ava-bronze::before{
  box-shadow: 0 0 0 2px color-mix(in lab, var(--mf-accent) 35%, transparent), 0 6px 18px rgba(0,0,0,.35);
}
.mf-player:active .mf-ava-bronze::before{ filter: saturate(1.06); }

.mf-avatar-wrap{
  position:relative; width:var(--mf-ava); aspect-ratio: 2 / 3; height:auto; isolation:isolate; margin-bottom: 2px;
  overflow: visible !important;
  transform-style: preserve-3d;
  will-change: transform;
}
.mf-avatar{
  display:block; width:100%; height:100%; border-radius:10px; object-fit:cover; border:1px solid #2d323b; background:#15181d;
  backface-visibility: hidden;
  transform-style: preserve-3d;
  will-change: transform;
}
.mf-avatar.placeholder{ display:flex; align-items:center; justify-content:center; font-weight:900; color:#c6cbd3; font-size:20px; }

/* Skeleton loader для аватарок */
.mf-skel{
  position:absolute; inset:0; border-radius:10px; overflow:hidden;
  background: linear-gradient(90deg, rgba(255,255,255,.06) 25%, rgba(255,255,255,.12) 37%, rgba(255,255,255,.06) 63%);
  background-size: 400% 100%;
  animation: mf-shimmer var(--dur-560) linear infinite;
  z-index: 1;
}
@keyframes mf-shimmer { 0%{ background-position: 100% 0 } 100%{ background-position: 0 0 } }

.mf-owner-crown{ position:absolute; left:50%; top:-0.28em; transform: translateX(-50%); font-size: calc(var(--mf-ava) * .36); line-height:1; filter: drop-shadow(0 2px 4px rgba(0,0,0,.45)); z-index:5; pointer-events:none; }

/* ============================== MAFIA MARK (цель/нож) ============================== */
.mf-mafia-mark{
  position: absolute;
  top: -10px;
  right: -10px;
  z-index: 12; /* выше короны (5) и рамки (7) */
  pointer-events: none;
  font-size: clamp(16px, calc(var(--mf-ava) * .42), 22px);
  line-height: 1;
  text-shadow: 0 1px 0 rgba(0,0,0,.5);
  filter: drop-shadow(0 2px 6px rgba(0,0,0,.45));
}
.mf-mafia-mark .cnt{
  display:inline-block;
  margin-left:2px;
  font-size:.8em;
  font-weight:1000;
}
.mf-mafia-mark.mine{
  /* «моя цель»: лёгкое свечение, чтобы отличать */
  filter: drop-shadow(0 0 8px rgba(255,255,255,.25)) drop-shadow(0 2px 6px rgba(0,0,0,.45));
}
.mf-mafia-mark.don{
  color: var(--role-don);
  text-shadow: 0 0 12px rgba(223,174,87,.28), 0 1px 0 rgba(0,0,0,.4);
}

/* ПИН: базовая точка + состояния (ready/ not-ready / rip) */
.mf-dot{
  position:absolute; right:-3px; bottom:-3px;
  width:14px; height:14px; border-radius:50%;
  border:2px solid var(--mf-bg); z-index:3;
}
/* READY indicator (Lobby only): те, кто НЕ нажал "Готов" — красный; кто нажал — зелёный */
.mf-dot.ok {
  display:inline-block; width:10px; height:10px; border-radius:50%;
  margin-right:6px; background:#ef4444;
}
.mf-dot.ok.ready { background:#22c55e; }
.mf-dot.ok.not-ready { background:#ef4444; }
.mf-dot.rip{ background:var(--mf-danger); }

.mf-role-badge{ position:absolute; bottom:-8px; left:50%; transform:translateX(-50%); border-radius:999px; padding:3px 8px; font-size:10px; font-weight:900; border:1px solid transparent; white-space:nowrap; backdrop-filter: blur(2px); z-index:2; }
/* Бейджи ролей — через токены */
.role-MAFIA      { background:#a7b2bf26; color:var(--role-mafia);      border-color:#a7b2bf44; }
.role-DON        { background:#a7b2bf26; color:var(--role-don);        border-color:#a7b2bf44; }
.role-DOCTOR     { background:#59d18526; color:var(--role-doctor);     border-color:#59d18544; }
.role-SHERIFF    { background:#ffd36926; color:var(--role-sheriff);    border-color:#ffd36944; }
.role-CIVIL      { background:#9aa4b226; color:var(--role-civil);      border-color:#9aa4b244; }
.role-BODYGUARD  { background:#6bb6ff26; color:var(--role-bodyguard);  border-color:#6bb6ff44; }
.role-PROSTITUTE { background:#ff7acb26; color:var(--role-prostitute); border-color:#ff7acb44; }
.role-JOURNALIST { background:#9ea7ff26; color:var(--role-journalist); border-color:#9ea7ff44; }
.role-SNIPER     { background:#ff9a6b26; color:var(--role-sniper);     border-color:#ff9a6b44; }

.mf-dead-onava{
  position:absolute; inset:0; display:flex; align-items:center; justify-content:center; border-radius:10px;
  background: repeating-linear-gradient(135deg, rgba(11,12,14,.65) 0, rgba(11,12,14,.65) 8px, rgba(11,12,14,.35) 8px, rgba(11,12,14,.35) 16px );
  font-weight:1000; letter-spacing:.14em; font-size:12px; color: var(--mf-danger);
  text-shadow: 0 1px 2px rgba(0,0,0,.7); z-index:2; pointer-events:none;
}

.mf-nick{ width: 100%; font-weight:800; font-size:14px; text-align:center; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; min-width: 0; unicode-bidi: plaintext; font-variant-east-asian: proportional-width; }
.mf-ready-summary{ text-align:center; font-size:13px; color:#dfe3ea; opacity:.95; }

/* Старый кольцевой прогресс прячем */
.mf-vote-ring{ display:none !important; }

/* ============================== BOTTOM SHEET ============================== */
.mf-sheet{ position:fixed; inset:0; background:rgba(6,8,12,.5); display:flex; align-items:flex-end; z-index:1000; -webkit-backdrop-filter: blur(2px); backdrop-filter: blur(2px); }
.mf-sheet-card{ width:100%; background:linear-gradient(180deg,#0f1116 0%, #0a0c10 100%); border-top-left-radius:16px; border-top-right-radius:16px; border:1px solid var(--mf-border); padding:12px 12px calc(12px + var(--mf-safe-bottom)); max-height: calc(var(--mf-vh) - var(--mf-safe-bottom)); overflow:auto; overscroll-behavior: contain; }
.mf-sheet-head{ display:flex; align-items:center; gap:12px; padding-bottom:10px; border-bottom:1px solid var(--mf-sep); }
.mf-sheet-ava{ width:52px; height:78px; border-radius:10px; overflow:hidden; border:1px solid var(--mf-border); background:#15181d; display:flex; align-items:center; justify-content:center; flex: 0 0 auto; }
.mf-sheet-ava img{ width:100%; height:100%; object-fit:cover; display:block; }
.mf-sheet-ava .ph{ font-weight:900; color:#c6cbd3; font-size:18px; }
.mf-sheet-title{ min-width:0; flex:1 1 auto; }
.mf-sheet-title .nick{ font-weight:900; font-size:16px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; min-width:0; }
.mf-sheet-title .sub{ color:#c6cbd3; font-size:12px; margin-top:2px; }
.mf-sheet-actions{ display:flex; flex-direction:column; gap:8px; padding-top:10px; }
.mf-iconbtn{ background:transparent; border:none; color:var(--mf-fg); font-size:18px; padding:4px 8px; cursor:pointer; }
.mf-btn.sheet{ width:100%; text-align:center; border-radius:12px; font-weight:900; }
.mf-btn.sheet.primary{
  background: linear-gradient(180deg,#2d3641 0%, #1b2129 100%) padding-box,
             linear-gradient(120deg,#6b7784,#a3b1be) border-box;
  border:1px solid transparent; color:#eaf0f6;
}
.mf-btn.sheet.ok{ background:#183728; border:1px solid #244f3a; }
.mf-btn.sheet.warn{ background:#3b2f18; border:1px solid #6b552a; }
.mf-btn.sheet.danger{ background:#2b1515; border:1px solid #6b2a2a; }
.mf-btn.sheet.ghost{ background:transparent; border:1px dashed #3a404c; color:#c6cbd3; }

/* ============================== VOTE BOARD ============================== */
.mf-vote{
  background:
    linear-gradient(180deg, rgba(24,26,32,.92), rgba(12,14,18,.86)) padding-box,
    linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.02)) border-box;
  border:1px solid transparent;
  border-radius:16px;
  padding:11px 12px;
  display:flex; flex-direction:column; gap:8px;
  box-shadow: var(--elev-floating);
  backdrop-filter: blur(10px) saturate(120%);
}
.mf-vote-title{
  font-weight:1000; font-size:15px;
  display:flex; align-items:center; justify-content:space-between; gap:8px;
}
.mf-vote-left{
  color:#d0d3da; font-size:12px;
  padding:5px 8px; border-radius:10px;
  background: rgba(255,255,255,.05);
}
.mf-vote-rows{ display:flex; flex-direction:column; gap:8px; max-height: 220px; overflow:auto; padding-right:2px; }
.mf-vote-row{
  display:grid; grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr) auto auto; gap:10px; align-items:center;
}
.mf-vote-name{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; min-width:0; unicode-bidi: plaintext; font-variant-east-asian: proportional-width; font-weight:900; }

.mf-vote-bar{
  position:relative; width:100%; height:10px; border-radius:999px; overflow:hidden;
  background:
    linear-gradient(180deg,#2d333d,#151a21) padding-box,
    linear-gradient(120deg,#7a8795,#b3c0cc) border-box;
  border:1px solid transparent;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.05);
}
.mf-vote-bar i{
  position:absolute; left:0; top:0; bottom:0;
  width: var(--votePct, 0%);
  background:
    radial-gradient(100% 180% at 0% 50%, rgba(255,30,30,.55), transparent 60%),
    linear-gradient(90deg, #ff2d2d, #ff6a6a);
  box-shadow:
    0 0 10px rgba(255,45,45,.55),
    0 0 18px rgba(255,90,90,.35) inset;
  transition: width .22s cubic-bezier(.2,.8,.2,1);
  will-change: width;
}
.mf-vote-row.leader .mf-vote-bar{
  box-shadow: 0 0 0 1px rgba(255,255,255,.06) inset, 0 6px 18px rgba(0,0,0,.35) inset;
}
.mf-vote-row.leader .mf-vote-bar i{ filter: saturate(1.08) brightness(1.05); }

.mf-vote-bar::after{ content:""; position:absolute; top:0; bottom:0; width:2px; left: calc((var(--vote-threshold, .5) * 100%) - 1px); background: rgba(255,255,255,.28); opacity:.6; }
.mf-vote-count{ min-width:26px; text-align:right; font-weight:900; }
.mf-vote-pct{ min-width:38px; text-align:right; color:#d6dae2; font-size:12px; font-weight:900; }
.mf-vote-empty{
  text-align:center;
  color:#d6dae2;
}

.mf-vote-modal{
  position:fixed; inset:0; z-index:1200;
  display:flex; align-items:flex-start; justify-content:center;
  padding: calc(12px + var(--mf-safe-top)) 12px 16px;
  background: rgba(8,10,14,.55);
  -webkit-backdrop-filter: blur(4px);
  backdrop-filter: blur(4px);
  animation: mf-fade-in .22s ease;
}
.mf-vote-modal-card{
  position:relative;
  width:min(420px, 96vw);
  margin-top:6px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.08);
  background:
    linear-gradient(180deg, rgba(16,18,22,.92), rgba(10,12,16,.95)) padding-box,
    linear-gradient(120deg, #6b7784, #a3b1be) border-box;
  box-shadow: var(--elev-modal);
  animation: mf-pop-in .32s var(--ease-out);
  padding: 14px 14px 16px;
  display:flex;
  flex-direction:column;
  gap:12px;
  max-height: min(82vh, 760px);
  overflow:hidden;
}
.mf-vote-modal-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.mf-vote-modal-title{
  font-weight:1000;
  letter-spacing:.04em;
}
.mf-vote-close{
  width:34px; height:34px;
  display:grid; place-items:center;
  border-radius:10px;
  border:1px solid rgba(255,255,255,.08);
  background: rgba(255,255,255,.04);
  color:#dfe3ea;
  font-weight:900;
  z-index:1;
}
.mf-vote-modal-body{
  flex:1;
  overflow:auto;
}

.mf-confirm{
  position:fixed; inset:0; z-index:1200;
  display:grid; place-items:center;
  padding: 12px;
  background: radial-gradient(140% 140% at 50% -10%, rgba(110,135,160,.18), transparent 60%), rgba(8,10,14,.55);
  -webkit-backdrop-filter: blur(5px);
  backdrop-filter: blur(5px);
  animation: mf-fade-in .18s ease;
}
.mf-confirm-card{
  width: min(420px, 94vw);
  border-radius:16px;
  border:1px solid rgba(255,255,255,.08);
  background:
    linear-gradient(180deg, rgba(16,18,22,.94), rgba(10,12,16,.96)) padding-box,
    linear-gradient(120deg, #6b7784, #a3b1be) border-box;
  box-shadow: var(--elev-modal);
  padding:16px;
  animation: mf-pop-in .28s var(--ease-out);
}
.mf-confirm-title{
  font-weight:1000;
  letter-spacing:.04em;
  font-size:16px;
  margin-bottom:12px;
}
.mf-confirm-actions{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:10px;
}
.mf-confirm-actions .mf-btn{
  min-height:42px;
  width:100%;
}

/* ============================== FEED (EVENTS) ============================== */
.mf-feed{ --line: rgba(255,255,255,0.14); --glow: 0 4px 24px rgba(255,255,255,0.08); --chip: rgba(255,255,255,0.06); padding: 8px 12px 12px; border-radius: 16px; background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)); box-shadow: var(--glow); width:100%; }
.mf-feed.empty{ opacity:.75; font-size:14px; }
.mf-feed.compact{ margin-top:0; }
.mf-feed-title{ font-weight:900; font-size:14px; letter-spacing:.02em; opacity:.95; margin-bottom:8px; }
.mf-feed-list{ list-style:none; margin:0; padding:0 0 0 10px; position:relative; }
.mf-feed-list::before{ content:""; position:absolute; left:2px; top:4px; bottom:4px; width:2px; background: linear-gradient(180deg, var(--line), transparent 70%); border-radius:2px; }
.mf-feed-item{ position: relative; margin: 8px 0; padding: 10px 12px 10px 14px; background: var(--chip); border: 1px solid rgba(255,255,255,0.08); border-radius: 14px; backdrop-filter: blur(6px); line-height: 1.25; }

/* ============================== EVENTS MODAL ============================== */
.mf-events-modal{ position:fixed; inset:0; z-index:1100; display:grid; place-items:center; background:rgba(8,10,14,.55); -webkit-backdrop-filter: blur(3px); backdrop-filter: blur(3px); }
.mf-events-card{
  width:min(92vw, 720px); max-height:min(78vh, 860px); overflow:auto; border-radius:18px;
  border:1px solid rgba(255,255,255,0.08);
  background:
    linear-gradient(180deg, rgba(16,18,22,.92), rgba(10,12,16,.95)) padding-box,
    linear-gradient(120deg, #6b7784, #a3b1be) border-box;
  box-shadow: var(--elev-modal);
  animation: mf-pop-in .34s var(--ease-out);
}
.mf-events-head{ position:sticky; top:0; display:grid; grid-template-columns: 1fr auto auto; align-items:center; gap:8px; padding:12px; background: linear-gradient(180deg, rgba(10,12,16,.9), rgba(10,12,16,.65)); border-bottom:1px solid rgba(255,255,255,.06); z-index:1; }
.mf-events-title{ font-weight:900; letter-spacing:.02em; }
.mf-events-filters{ display:flex; gap:6px; align-items:center; justify-content:center; }
.mf-events-close{ font-size:20px; }
.mf-events-body{ padding:10px 12px 14px; }
@keyframes mf-pop-in { 0% { opacity:0; transform: translateY(6px) scale(.98); } 100% { opacity:1; transform: translateY(0) scale(1); } }

/* ============================== ROLE MODAL / REVEAL / FLY ============================== */
.mf-role-modal{ position:fixed; inset:0; z-index:1100; display:flex; align-items:center; justify-content:center; background:rgba(8,10,14,.55); }
/* увеличена ширина + анимация появления */
.mf-role-card{
  width:min(92vw, 460px);
  background:linear-gradient(180deg, rgba(16,18,22,.9), rgba(10,12,16,.92));
  border:1px solid var(--mf-border);
  border-radius:18px;
  padding:16px 14px;
  text-align:center;
  perspective: 1000px;
  transform-style: preserve-3d;
  opacity:0; transform: translateY(6px) scale(.98);
  animation: mf-role-appear .44s var(--ease-out) forwards;
}
.mf-role-ico{ font-size:40px; margin-bottom:6px; }
.mf-role-title{ font-size:20px; font-weight:900; margin-bottom:4px; letter-spacing:.02em; }
.mf-role-desc{ color:#cfd3da; margin-bottom:8px; }

/* Контент скрыт до flip */
.mf-role-card[data-flipped="false"] .mf-role-title,
.mf-role-card[data-flipped="false"] .mf-role-desc,
.mf-role-card[data-flipped="false"] .mf-role-cta{
  opacity:0; transform: translateY(6px);
  pointer-events:none;
}
.mf-role-card[data-flipped="true"] .mf-role-title,
.mf-role-card[data-flipped="true"] .mf-role-desc,
.mf-role-card[data-flipped="true"] .mf-role-cta{
  opacity:1; transform: translateY(0);
  transition: opacity .25s ease .06s, transform .25s ease .06s;
}
/* дополнительный «reveal» текста после flip */
.mf-role-card[data-flipped="true"] .mf-role-title{
  animation: mf-role-title-reveal .36s ease both;
}
.mf-role-card[data-flipped="true"] .mf-role-desc{
  animation: mf-role-desc-reveal .52s ease .06s both;
}

/* ширина аватарки в карточке роли */
.mf-role-card .mf-avatar-wrap{ width: calc(var(--mf-ava) * 1.48); margin-inline: auto; }

/* Кнопка «Погнали!» не ловит клики в disabled-состоянии */
.mf-role-card .mf-role-cta[disabled]{ pointer-events: none; }

/* Flip-контейнер */
.mf-role-ghost{ position: relative; }
.mf-role-flip{
  position: relative;
  width: 100%; height: 100%;
  transform-style: preserve-3d;
  transition: transform .6s ease;
  transform: rotateY(180deg);
  will-change: transform;
}
.mf-role-flip.is-flipped{ transform: rotateY(0deg); }
.mf-role-face{
  position:absolute; inset:0;
  backface-visibility: hidden;
  border-radius:10px; overflow:hidden;
  border:1px solid var(--mf-border);
  background:#15181d;
}
.mf-role-face.back{ transform: rotateY(180deg); }

/* Усиленный режим flying: оверлей полностью «прозрачный» и не ловит клики */
.mf-role-modal.flying{
  background: transparent !important;
  opacity: 0 !important;
  pointer-events: none !important;
}
.mf-role-modal.flying .mf-role-card{ opacity: 0 !important; }

/* Полётные эффекты */
.mf-role-ghost.mf-flight{ filter: saturate(1.04) brightness(1.02); }
.mf-role-ghost.mf-flight::after{
  content:""; position:absolute; inset:-6px; border-radius:10px; pointer-events:none;
  background:
    radial-gradient(80% 180% at 50% -20%, rgba(255,255,255,.16), rgba(255,255,255,0) 60%),
    linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0));
  mix-blend-mode: screen; opacity:.45;
  animation: mf-flight-trail .52s ease forwards;
}
@keyframes mf-flight-trail{
  0%{ opacity:.45; } 70%{ opacity:.20; } 100%{ opacity:0; }
}

/* Во время полёта скрываем ВСЮ обёртку (сохраняя место) */
.mf-ava-hidden{ visibility: hidden; }
/* При открытой роли скрываем мой аватар, чтобы не подсвечивался раньше полёта */
body.mf-role-open .mf-player.me .mf-avatar-wrap{ visibility: hidden; }

/* Летун — БЕЗ paint-containment, иначе псевдоэлементы рамки обрезаются */
.mf-role-fly{
  contain: layout style;
  overflow: visible !important;
  will-change: transform;
}

/* ============================== PERF HINTS ============================== */
body.mf-animating .mf-hud,
body.mf-animating .mf-gamestage{
  -webkit-backdrop-filter: none !important;
  backdrop-filter: none !important;
}
.mf-tex-phasebg,
.mf-toast-card,
.mf-events-toggle,
.mf-avatar{
  will-change: opacity, transform;
  contain: paint;
}

/* ============================== NET / ENDED ============================== */
.mf-net{ position:sticky; top:0; z-index:21; display:flex; gap:8px; align-items:center; margin:8px 0; padding:8px 12px; border-radius:12px; border:1px solid #6b552a; background:rgba(59,47,24,.35); color:#ffe7b0; backdrop-filter: blur(6px); }
.mf-net .ico{ opacity:.9 }
.mf-net .txt{ font-size:13px; }

.mf-endedbar { position: sticky; bottom: 0; inset-inline: 0; padding: 10px 12px var(--mf-safe-bottom); background: linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,0.55) 35%); }
.mf-endedbar-inner { display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 12px; padding: 10px; border-radius: 16px; background: rgba(20,20,24,0.8); border: 1px solid rgba(255,255,255,0.08); backdrop-filter: blur(8px); }
.mf-endedbar-title { font-weight: 800; opacity: .9; }
.mf-endedbar-btn { min-width: 180px; }
@media (max-width: 390px) { .mf-endedbar-inner { grid-template-columns: 1fr; } .mf-endedbar-btn { width: 100%; } }

/* ============================== EMPTY / SAFE ============================== */
.mf-empty{
  display:flex; align-items:center; justify-content:center;
  min-height:120px; border:1px dashed var(--mf-border); border-radius:12px;
  color:#d6dae2; background: rgba(22,24,28,.28);
  text-align:center; padding:16px;
}
.mf-safe{ height: var(--mf-safe-bottom); }

/* ============================== ACCESSIBILITY / UTILS ============================== */
button:focus-visible, .mf-chip:focus-visible, .mf-input:focus-visible, .mf-gs-chip:focus-visible, .mf-gs-day:focus-visible { outline:2px solid color-mix(in lab, var(--mf-accent) 35%, transparent); outline-offset:2px; }
.mf-player:focus-visible { outline:none; }
.sr-only{ position:absolute !important; width:1px !important; height:1px !important; padding:0 !important; margin:-1px !important; overflow:hidden !important; clip:rect(0,0,0,0) !important; white-space:nowrap !important; border:0 !important; }

/* ============================== AVATAR FRAME (UNIVERSAL) ============================== */
.mf-ava-bronze{
  --brz-w: clamp(3px, calc(var(--mf-ava) * .06), 7px);
  --brz-r: calc(10px + var(--brz-w));
  --brz-base: #3b454f;
  --brz-dark: #12161b;
  --brz-light: #a8b2be;
  --brz-edge: #e7edf5;
  --brz-patina: #5b6672;
  position: relative; isolation: isolate; overflow: visible !important; z-index: 7;
  transform-style: preserve-3d;
}

/* Псевдоэлементы рамки + неоновая заливка */
.mf-ava-bronze::before{
  content:""; position:absolute; inset: calc(var(--brz-w) * -1); border-radius: var(--brz-r); padding: var(--brz-w); pointer-events:none; z-index:2;
  background:
    radial-gradient(120% 180% at 30% -10%, color-mix(in lab, var(--brz-edge) 52%, transparent) 0 60%, transparent 61%),
    conic-gradient(from 210deg, var(--brz-light) 0deg, var(--brz-base) 80deg, var(--brz-dark) 160deg, var(--brz-base) 260deg, var(--brz-light) 360deg),
    linear-gradient(180deg, color-mix(in lab, var(--brz-light) 38%, var(--brz-base)) 0%, var(--brz-dark) 100%),
    radial-gradient(160% 120% at 0% 0%, color-mix(in lab, var(--brz-patina) 16%, transparent), transparent 60%),
    radial-gradient(160% 160% at 120% -10%, color-mix(in lab, var(--brz-patina) 12%, transparent), transparent 60%),
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 120 120'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='120' height='120' filter='url(%23n)' opacity='0.12'/%3E%3C/svg%3E");
  background-blend-mode: overlay, normal, normal, overlay, overlay, multiply;
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor; mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); mask-composite: exclude;
  box-shadow: 0 2px 10px rgba(0,0,0,.35), 0 0 0 1px rgba(255,255,255,.04) inset;
}
.mf-ava-bronze::after{
  content:""; position:absolute; inset: calc(var(--brz-w) * -1); border-radius: var(--brz-r); padding: var(--brz-w); pointer-events:none; z-index:3;
  background:
    conic-gradient(from -90deg at 50% 50%,
      rgba(255, 61, 61, .95) 0 calc(var(--voteRatio, 0) * 360deg),
      rgba(255, 61, 61, 0) calc(var(--voteRatio, 0) * 360deg) 360deg),
    radial-gradient(70% 160% at calc(var(--mx, .5) * 100%) calc(var(--my, .2) * 100%), rgba(255,255,255,.18), rgba(255,255,255,0) 60%),
    conic-gradient(from 150deg at 50% 50%, rgba(255,255,255,.14) 0 8%, rgba(255,255,255,0) 8% 48%, rgba(255,255,255,.14) 48% 52%, rgba(255,255,255,0) 52% 92%, rgba(255,255,255,.14) 92% 100%);
  mix-blend-mode: screen;
  opacity:.75; transition: opacity .25s ease;
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor; mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); mask-composite: exclude;
  box-shadow:
    0 0 12px rgba(255, 61, 61, calc(var(--voteRatio,0) * .45)),
    0 0 18px rgba(255, 61, 61, calc(var(--voteRatio,0) * .35)) inset;
}
.mf-ava-bronze[data-voted="true"]::after{ opacity: .95; }

/* === UNIVERSAL FLIP: по [data-flipped] на карточке ИЛИ на самой рамке === */
.mf-ava-bronze::before,
.mf-ava-bronze::after{
  transform-origin: center;
  backface-visibility: hidden;
  transition: transform .6s ease;
}

/* рамка «спиной» */
.mf-role-card[data-flipped="false"] .mf-ava-bronze::before,
.mf-role-card[data-flipped="false"] .mf-ava-bronze::after,
.mf-ava-bronze[data-flipped="false"]::before,
.mf-ava-bronze[data-flipped="false"]::after{
  transform: rotateY(180deg);
}

/* рамка «лицом» */
.mf-role-card[data-flipped="true"] .mf-ava-bronze::before,
.mf-role-card[data-flipped="true"] .mf-ava-bronze::after,
.mf-ava-bronze[data-flipped="true"]::before,
.mf-ava-bronze[data-flipped="true"]::after{
  transform: rotateY(0deg);
}

/* ============================== TOASTS ============================== */
.mf-toasts{
  position: fixed;
  left: 50%;
  bottom: calc(14px + var(--mf-safe-bottom));
  transform: translateX(-50%);
  display: flex; flex-direction: column; gap: 8px; width: min(92vw, 560px);
  z-index: 1300; pointer-events: none;
}
.mf-toast-card{
  --toast-index: 0; --lift: calc(var(--toast-index) * 6px);
  pointer-events: auto;
  display: grid; grid-template-columns: auto 1fr; align-items: center; gap: 10px;
  padding: 10px 12px; border-radius: 14px;
  background: linear-gradient(180deg, rgba(22,24,28,.92), rgba(14,16,20,.90));
  border: 1px solid var(--mf-border);
  box-shadow: 0 10px 26px rgba(0,0,0,.35);
  transform: translateY(calc(16px - var(--lift))) scale(.98);
  opacity: 0;
  transition: transform .24s cubic-bezier(.2,.8,.2,1), opacity .24s ease;
}
.mf-toast-card.in{ transform: translateY(calc(0px - var(--lift))) scale(1); opacity: 1; }
.mf-toast-card .ico{ font-size: 18px; filter: drop-shadow(0 2px 6px rgba(0,0,0,.35)); }
.mf-toast-card .txt{ min-width: 0; }
.mf-toast-card .title{ font-weight: 900; letter-spacing: .01em; display: flex; align-items: center; gap: 8px; }
.mf-toast-card .sub{ color: #d6dae2; font-size: 12px; margin-top: 2px; opacity: .95; }
.mf-toast-card .tag{
  border-radius: 999px; padding: 2px 8px; font-size: 11px; font-weight: 900;
  border: 1px solid rgba(255,255,255,.12); backdrop-filter: blur(2px);
}
.mf-toast-card .tag.good{ background: #183728; color: #6fe2a0; border-color: #244f3a; }
.mf-toast-card .tag.bad { background: #2b1515; color: #ff9a9a; border-color: #6b2a2a; }

.mf-toast-card.info    { border-color: #3a404c; }
.mf-toast-card.ok,
.mf-toast-card.success { border-color: #244f3a; }
.mf-toast-card.warn    { border-color: #6b552a; }
.mf-toast-card.danger,
.mf-toast-card.error   { border-color: #6b2a2a; }

/* CTA-вариант тоста (для ночных действий) */
.mf-toast-card.has-cta{ grid-template-columns: auto 1fr auto; }
.mf-toast-cta{ display:flex; align-items:center; }
.mf-toast-btn{
  background: linear-gradient(180deg,#2d3641 0%, #1b2129 100%) padding-box,
             linear-gradient(120deg,#6b7784,#a3b1be) border-box;
  border:1px solid transparent;
  color:#eaf0f6;
  text-shadow: 0 1px 0 rgba(0,0,0,.65);
  box-shadow: 0 1px 0 rgba(255,255,255,.06) inset, 0 8px 16px rgba(0,0,0,.35);
  border-radius: 10px;
  padding: 6px 12px;
  font-weight: 900;
  cursor: pointer;
}
.mf-toast-btn:active{ transform: translateY(1px); }

/* ============================== NightAlertToast (модальный «только ОК») ===== */
.mf-alerttoast-modal{
  position:fixed; inset:0; z-index:1400; display:grid; place-items:center;
  background: rgba(8,10,14,.55);
  -webkit-backdrop-filter: blur(3px); backdrop-filter: blur(3px);
}
.mf-alerttoast-card{
  display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:10px;
  width:min(92vw,560px); border-radius:16px; border:1px solid var(--mf-border);
  background: linear-gradient(180deg, rgba(22,24,28,.92), rgba(14,16,20,.90));
  box-shadow: var(--elev-modal); padding:12px;
}
.mf-alerttoast-card .ico{ font-size:18px; }
.mf-alerttoast-card .title{ font-weight:900; letter-spacing:.01em; display:flex; align-items:center; gap:8px; }
.mf-alerttoast-card .sub{ color:#d6dae2; font-size:12px; margin-top:2px; opacity:.95; }
.mf-alerttoast-actions{ display:flex; align-items:center; justify-content:flex-end; }

/* Встряска при ESC (escBehavior:'shake') */
.mf-shake{ animation: mf-shake .36s var(--ease-out); }
@keyframes mf-shake{
  10%,90% { transform: translateX(-1px) }
  20%,80% { transform: translateX( 2px) }
  30%,50%,70% { transform: translateX(-4px) }
  40%,60% { transform: translateX( 4px) }
}

/* ============================== Tooltip ============================== */
.mf-tooltip{
  position:absolute; bottom: calc(100% + 6px); left:50%; transform: translateX(-50%);
  white-space:nowrap; border-radius:8px; padding:6px 8px; font-size:12px;
  background: rgba(20,22,26,.92); border:1px solid rgba(255,255,255,.08);
  opacity:0; pointer-events:none; transition: opacity var(--dur-180) var(--ease-out);
  box-shadow: var(--elev-surface);
}
.mf-player:hover .mf-tooltip, .mf-player:focus-visible .mf-tooltip{ opacity:1; }

/* ============================== Phase flash ============================== */
.mf-phase-flash{
  position:absolute; inset:0; z-index:0; pointer-events:none;
  background: radial-gradient(120% 160% at 50% 50%, var(--mf-phase-tint), transparent 60%);
  opacity:0; transition: opacity var(--dur-180) var(--ease-out);
}
.mf-phase-flash.in{ opacity:.6; }

/* ============================== Skip-link ============================== */
.mf-skip{
  position:absolute; left:8px; top:8px; z-index:2000;
  padding:6px 10px; border-radius:10px; background:#11141a; color:#fff; border:1px solid #3a404c;
  transform: translateY(-200%); transition: transform var(--dur-180) var(--ease-out);
}
.mf-skip:focus{ transform: translateY(0); outline:2px solid color-mix(in lab, var(--mf-accent) 35%, transparent) }

/* ========================= SHERIFF DOSSIER ========================= */
.mf-dossier-modal{
  position:fixed; inset:0; z-index:1150;
  display:grid; place-items:center;
  background: rgba(8,10,14,.55);
  -webkit-backdrop-filter: blur(3px); backdrop-filter: blur(3px);
}
.mf-dossier-card{
  width:min(92vw, 560px);
  border-radius:18px;
  border:1px solid rgba(255,255,255,.08);
  background:
    linear-gradient(180deg, rgba(16,18,22,.92), rgba(10,12,16,.95)) padding-box,
    linear-gradient(120deg, #6b7784, #a3b1be) border-box;
  box-shadow: 0 14px 42px rgba(0,0,0,.6), 0 6px 20px rgba(0,0,0,.45) inset;
  animation: mf-pop-in .34s var(--ease-out);
}
.mf-dossier-head{
  display:grid; grid-template-columns: 1fr auto; align-items:center; gap:8px;
  padding:12px; border-bottom:1px solid rgba(255,255,255,.06);
}
.mf-dossier-kicker{
  font-size:12px; letter-spacing:.08em; text-transform:uppercase; color:#cfd3da; opacity:.9;
}
.mf-dossier-body{
  display:grid; grid-template-columns: auto 1fr; gap:12px; align-items:center;
  padding:12px;
}
.mf-dossier-ava{
  width:84px; height:126px; border-radius:10px; overflow:hidden;
  border:1px solid var(--mf-border); background:#15181d; display:flex; align-items:center; justify-content:center;
}
.mf-dossier-ava img{ width:100%; height:100%; object-fit:cover; display:block; }
.mf-dossier-ava .ph{ font-weight:900; color:#c6cbd3; font-size:18px; }
.mf-dossier-info{ position:relative; min-height:126px; display:flex; align-items:center; justify-content:flex-start; }
.mf-dossier-title{ font-size:20px; font-weight:900; letter-spacing:.02em; margin:0; z-index:1; }
.mf-dossier-stamp{
  position:absolute; right:8px; bottom:6px; z-index:0;
  font-weight:1000; letter-spacing:.14em; font-size: clamp(18px, 5.6vw, 26px);
  padding:6px 10px; border:3px solid currentColor; border-radius:8px;
  transform: rotate(-8deg);
  mix-blend-mode: normal;
  opacity:.95;
}
.mf-dossier-stamp.good{ color:#65c39a; text-shadow: 0 0 18px rgba(101,195,154,.28); }
.mf-dossier-stamp.bad { color:#d14d4d; text-shadow: 0 0 18px rgba(209,77,77,.28); }
.mf-dossier-foot{ padding:10px 12px 14px; display:flex; justify-content:flex-end; }

/* ============================== RESPONSIVE ============================== */
@media (max-width:768px){
  :root{ --mf-center-min: 56px; --mf-edge-pad: 6px; }
  .mf-hud{ padding:10px; border-radius:12px; }
  .mf-gs-timer{ min-width:0; }
  .mf-grid{ gap:8px; }
  .mf-events-toggle{ top: calc(6px + var(--mf-safe-top)); padding:10px 16px; }
  .mf-role-card{ width: min(94vw, 460px); }
  .mf-sheet-card{ padding:10px 10px calc(10px + var(--mf-safe-bottom)); }
}
/* NEW: точечные пороги 1024/720/480/390 */
@media (max-width: 1024px){
  :root{ --mf-center-max: 460px; --mf-grid-gap: 10px; }
}
@media (max-width: 720px){
  :root{ --mf-ava: 58px; }
  .mf-menu-logo{ text-shadow: 0 0 4px rgba(0,0,0,.25); }
}
@media (max-width: 540px){
  .mf-vote-rows{ max-height: 200px; }
}
@media (max-width: 480px){
  :root{
    --mf-ava: 54px;
    --mf-grid-gap: 8px;
    --mf-center-col: clamp(150px, 62vw, 220px);
  }
  .mf-slot.left{ padding-left: 8px; }
  .mf-slot.right{ padding-right: 8px; }
}
@media (max-width: 390px){
  :root{
    --mf-center-min: 48px;
    --mf-edge-pad: 6px;
    --mf-ava: 50px;
    --mf-center-col: clamp(140px, 68vw, 200px);
  }
  .mf-slot.left{ padding-left: 6px; }
  .mf-slot.right{ padding-right: 6px; }
  .mf-grid{ gap:6px; }
  .mf-chip.ghost{ min-height: 36px; }
}

/* ============================== LANDSCAPE ============================== */
@media (orientation: landscape){
  .mf-events-toggle{ bottom: 8px; top: auto; position: sticky; }
  /* уменьшение аватарок на ~12%, чтобы помещалось +15–20% игроков по высоте */
  :root{ --mf-ava: calc(var(--mf-ava) * .88); }
}

/* ============================== RTL ============================== */
:root[dir="rtl"] .mf-grid{
  grid-template-columns: max-content minmax(var(--mf-center-min), 1fr) max-content;
}
:root[dir="rtl"] .mf-col.left{  align-items:flex-end; }
:root[dir="rtl"] .mf-col.right{ align-items:flex-start; }

/* ========================================================================== */
/* ============================== OVERRIDES / CLEANUPS ======================= */
/* ========================================================================== */

/* Убираем «решётку» */
.mf-tex-grate{ display:none !important; opacity:0 !important; background:none !important; -webkit-mask:none !important; mask:none !important; }
body.mf-phase-lobby .mf-tex-grate{ opacity:0 !important; }

/* Нижний CTA в лобби */
.mf-center-cta.lobby-pinned{ position: static; margin-top: 6px; padding-bottom: 0; z-index: 20; }

/* CTA липнет к верху (старт / готов) */
.mf-events-toggle.mf-start-toggle,
.mf-events-toggle.mf-ready-toggle{
  position: static;
  top: auto !important;
  bottom: auto !important;
  width: auto;
  max-inline-size: min(100%, var(--mf-center-max));
  align-self: center;
}
@media (orientation: landscape){
  .mf-events-toggle.mf-start-toggle,
  .mf-events-toggle.mf-ready-toggle{ top: auto !important; }
}

/* Бейдж роли у выбывших — показываем */
.mf-player.dead .mf-role-badge{ display: inline-flex !important; z-index: 7; pointer-events: none; }

/* ========================================================================== */
/* ============================== @supports FALLBACKS ======================== */
/* ========================================================================== */

/* 1) Фолбэк при отсутствии backdrop-filter */
@supports not (backdrop-filter: blur(2px)) {
  .mf-hud,
  .mf-gamestage,
  .mf-feed .mf-feed-item,
  .mf-vote,
  .mf-vote-modal-card,
  .mf-events-card,
  .mf-hero,
  .mf-net,
  .mf-endedbar-inner {
    background-color: rgba(16,18,22,.92) !important;
    background-image: none !important;
    box-shadow: 0 1px 0 rgba(255,255,255,.04) inset, 0 10px 30px rgba(0,0,0,.55) !important;
  }
  .mf-events-modal,
  .mf-sheet {
    background-color: rgba(8,10,14,.75) !important;
  }
  .mf-role-card,
  .mf-confirm-card { background-color: rgba(16,18,22,.94) !important; }
}
/* На старом WebKit */
@supports not (-webkit-backdrop-filter: blur(2px)) {
  .mf-hud,
  .mf-gamestage,
  .mf-feed .mf-feed-item,
  .mf-vote,
  .mf-vote-modal-card,
  .mf-events-card,
  .mf-hero,
  .mf-net,
  .mf-endedbar-inner { -webkit-backdrop-filter: none !important; }
}

/* 2) Фолбэки color-mix() */
@supports not (color: color-mix(in lab, #000 50%, #fff)) {
  :root.theme-tg { --mf-border: rgba(236,239,242,.08); }
  .mf-gs-chip.active{ border-color: #4b5661; background: linear-gradient(180deg, rgba(142,164,181,.22), rgba(142,164,181,.12)); }
  .mf-hero{
    border-color: rgba(142,164,181,.35);
    background:
      radial-gradient(120% 160% at 20% -20%, rgba(142,164,181,.14), transparent 60%),
      radial-gradient(140% 160% at 110% -10%, rgba(169,186,202,.12), transparent 58%),
      repeating-linear-gradient(115deg, rgba(255,255,255,.03) 0 1px, transparent 1px 22px ),
      linear-gradient(180deg, #121417, #0c0e10);
  }
  .mf-hero-logo,
  .mf-menu-logo{
    background: linear-gradient(180deg, #ffffff, #e3e9ef);
    -webkit-background-clip: text; background-clip: text;
  }
  .mf-gamestage{
    background:
      linear-gradient(180deg, rgba(22,24,28,.6), rgba(14,16,20,.45)) padding-box,
      radial-gradient(120% 180% at 0% 0%, rgba(142,164,181,.22), transparent 60%) border-box !important;
  }
}

/* 3) Фолбэк conic-gradient() */
@supports not (background: conic-gradient(from 90deg, #000, #fff)) {
  .mf-tex-votefx{
    background:
      linear-gradient(180deg, color-mix(in lab, var(--mf-accent) 14%, transparent), transparent 60%),
      radial-gradient(120% 60% at 50% 110%, rgba(0,0,0,.35), transparent 60%) !important;
  }
  .mf-vote-ring{
    background: radial-gradient(circle at center, color-mix(in lab, var(--mf-accent) 85%, transparent), rgba(0,0,0,0) 60%) !important;
  }
}

/* 4) Фолбэк mask-composite для рамки карточки/плиток */
@supports not (mask-composite: exclude) {
  /* упрощаем рамку: без вычета, просто контур */
  .mf-ava-bronze::before,
  .mf-ava-bronze::after{
    -webkit-mask: none !important; mask: none !important;
    padding: 0 !important;
    background: none !important;
  }
  .mf-ava-bronze .mf-avatar{
    outline: 2px solid #a8b2be;
    outline-offset: 2px;
  }
}

/* ============================== KEYFRAMES ============================== */
@keyframes mf-role-appear{
  0%   { opacity:0; transform: translateY(10px) scale(.96); }
  70%  { opacity:1; transform: translateY(-2px) scale(1.012); }
  100% { opacity:1; transform: translateY(0)    scale(1); }
}
@keyframes mf-role-title-reveal{
  0% { letter-spacing:.06em; filter: blur(2px); opacity:0; }
  100% { letter-spacing:.02em; filter: blur(0); opacity:1; }
}
@keyframes mf-role-desc-reveal{
  0% { opacity:0; transform: translateY(6px); }
  100%{ opacity:1; transform: translateY(0); }
}

/* ============================== prefers-contrast: more ===================== */
@media (prefers-contrast: more){
  .mf-hud, .mf-gamestage, .mf-events-card, .mf-role-card, .mf-alerttoast-card {
    border-color: color-mix(in lab, var(--mf-fg) 18%, transparent);
    box-shadow: 0 0 0 1px rgba(255,255,255,.08) inset, 0 0 0 2px rgba(0,0,0,.35);
  }
  .mf-timer{ border-color: color-mix(in lab, var(--mf-fg) 18%, transparent); }
}

/* ============================== Themes ===================================== */
/* horror-light — более светлый «хоррор» */
html[data-theme="horror-light"]{
  --mf-accent:#b0b7c2;
  --mf-accent2:#d6dbe2;
}
/* noir-blue — тёмный с холодным акцентом (по умолчанию) */
html[data-theme="noir-blue"]{
  --mf-accent:#8ea4b5;
  --mf-accent2:#a9baca;
}
/* Базовая кнопка-иконка (если ещё нет) */
.mf-icon-button {
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;

  width: 32px;
  height: 32px;

  border-radius: 999px;
  border: 1px solid color-mix(in srgb, var(--text, #fff) 14%, transparent);
  background: color-mix(in srgb, var(--surface, rgba(255,255,255,0.06)) 100%, transparent);

  font-size: 18px;
  line-height: 1;
  padding: 0;

  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  box-shadow: 0 4px 12px rgba(0,0,0,.18);
  transition:
    background 0.16s ease,
    border-color 0.16s ease,
    transform 0.12s ease,
    box-shadow 0.16s ease;
}

.mf-icon-button:hover {
  background: color-mix(in srgb, var(--surface, rgba(255,255,255,0.12)) 90%, transparent);
  box-shadow: 0 6px 18px rgba(0,0,0,.22);
}

.mf-icon-button:active {
  transform: scale(0.94);
  box-shadow: 0 3px 8px rgba(0,0,0,.18);
}

/* Крестик в правом верхнем углу hero */
.mf-menu-hero {
  position: relative; /* чтобы крестик позиционировался внутри */
}

/* позиционирование именно этого крестика */
.mf-menu-close {
  position: absolute;
  top: max(8px, env(safe-area-inset-top));
  right: max(10px, env(safe-area-inset-right));

  /* чуть приглушим цвет под хиро */
  background: color-mix(in srgb, var(--surface, rgba(0,0,0,0.4)) 90%, transparent);
  backdrop-filter: blur(8px);
}

.mf-menu-close:hover {
  background: color-mix(in srgb, var(--surface, rgba(0,0,0,0.55)) 90%, transparent);
}
